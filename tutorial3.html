

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial 3: Using Cubemapping to Render a CAVE VR System &mdash; ratCAVE 0.5.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ratCAVE 0.5.0 documentation" href="index.html"/>
        <link rel="up" title="Tutorials" href="tutorials.html"/>
        <link rel="next" title="API Documentation" href="ratcave.html"/>
        <link rel="prev" title="Tutorial 2: Animating a Scene with Multiple Meshes, and using Multiple Scenes" href="tutorial2.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> ratCAVE
        

        
          
          <img src="_static/ratcave_example.png" class="logo" />
        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial1.html">Tutorial 1: Displaying a 3D Object</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial1.html#reading-a-wavefront-obj-file">Reading a Wavefront .obj file</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial1.html#creating-a-mesh-from-the-wavefrontreader-and-positioning-it">Creating a Mesh from the WavefrontReader and Positioning it</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial1.html#creating-a-scene">Creating a Scene</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial1.html#creating-a-window-and-rendering-the-scene">Creating a Window and Rendering the Scene</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial1.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial2.html">Tutorial 2: Animating a Scene with Multiple Meshes, and using Multiple Scenes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial2.html#scenes-hold-lists-of-meshes">Scenes Hold Lists of Meshes</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial2.html#moving-a-mesh">Moving a Mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial2.html#modifying-scene-s-background-color">Modifying Scene&#8217;s Background Color</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial2.html#changing-the-active-scene">Changing the Active Scene</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial2.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Tutorial 3: Using Cubemapping to Render a CAVE VR System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-the-virtual-scene">Create the Virtual Scene</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-the-projected-scene">Create the Projected Scene</a></li>
<li class="toctree-l3"><a class="reference internal" href="#put-the-scenes-into-a-window">Put the Scenes into a Window</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tracking-the-subject-player">Tracking The Subject / Player</a></li>
<li class="toctree-l3"><a class="reference internal" href="#display-loop">Display Loop</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-your-virtual-meshes-in-arena-coordinates">Setting your virtual meshes in Arena-Coordinates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-rotation-invariant-tracking-coordinates">Getting Rotation-Invariant Tracking Coordinates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ratcave.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ratcave.devices.html">ratcave.devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="ratcave.graphics.html">ratcave.graphics</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ratCAVE</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
      
    <li>Tutorial 3: Using Cubemapping to Render a CAVE VR System</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/tutorial3.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="tutorial-3-using-cubemapping-to-render-a-cave-vr-system">
<h1>Tutorial 3: Using Cubemapping to Render a CAVE VR System<a class="headerlink" href="#tutorial-3-using-cubemapping-to-render-a-cave-vr-system" title="Permalink to this headline">¶</a></h1>
<dl class="docutils">
<dt>CAVE VR relies on position updates from head trackers to render a virtual scene from the subject&#8217;s perspective in virtual space, then to warp a video projection so that to the viewer the virtual scene appears to be geometrically correct  We use a cubemapping approach to do just that:</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="ratcave.graphics.html#ratcave.graphics.Mesh" title="ratcave.graphics.Mesh"><code class="xref py py-class docutils literal"><span class="pre">Mesh</span></code></a> objects are placed into the virtual <a class="reference internal" href="ratcave.graphics.html#ratcave.graphics.Scene" title="ratcave.graphics.Scene"><code class="xref py py-class docutils literal"><span class="pre">Scene</span></code></a> object as in the previous two tutorials. However, this <a class="reference internal" href="ratcave.graphics.html#ratcave.graphics.Scene" title="ratcave.graphics.Scene"><code class="xref py py-class docutils literal"><span class="pre">Scene</span></code></a> is placed in the <code class="xref py py-attr docutils literal"><span class="pre">Window.virtual_scene</span></code> attribute, instead of the <code class="xref py py-attr docutils literal"><span class="pre">Window.active_scene</span></code> attribute.</li>
<li>The screen itself, being the thing that is actually projected by the display, is placed in as the <code class="xref py py-meth docutils literal"><span class="pre">Window.active_scene()</span></code>.  This <a class="reference internal" href="ratcave.graphics.html#ratcave.graphics.Scene" title="ratcave.graphics.Scene"><code class="xref py py-class docutils literal"><span class="pre">Scene</span></code></a> contains 3D-Modeled version of the the projected surface as a <a class="reference internal" href="ratcave.graphics.html#ratcave.graphics.Mesh" title="ratcave.graphics.Mesh"><code class="xref py py-class docutils literal"><span class="pre">Mesh</span></code></a> object, and its <code class="xref py py-meth docutils literal"><span class="pre">Mesh.cubemap()</span></code> attribute is set to True. The <em>Active Scene&#8217;s</em> <a class="reference internal" href="ratcave.graphics.html#ratcave.graphics.Camera" title="ratcave.graphics.Camera"><code class="xref py py-class docutils literal"><span class="pre">Camera</span></code></a> is then set to be in the same position, rotation, and other properties as the projector itself.  Getting accurate measurements of your projection surface and projector can be challenging, so ratCAVE comes with a few console scripts to give you an idea of how this can be made to work (and, if you&#8217;re from the Sirota lab at LMU, you can even use these scripts to automatically calibrate them both!).  Future versions will include a more general approach for different setups.</li>
<li>Each frame, the subject&#8217;s position is taken from a tracker (for Motive/Optitrack users, we&#8217;ve included a <a class="reference internal" href="ratcave.devices.html#ratcave.devices.Optitrack" title="ratcave.devices.Optitrack"><code class="xref py py-class docutils literal"><span class="pre">Optitrack</span></code></a> class for easily getting NatNet data, but any interface will work for this.) and set to the <em>Virtual Scene&#8217;s</em> camera position.  Simply calling the <a class="reference internal" href="ratcave.graphics.html#ratcave.graphics.Window.draw" title="ratcave.graphics.Window.draw"><code class="xref py py-meth docutils literal"><span class="pre">Window.draw()</span></code></a> and <a class="reference internal" href="ratcave.graphics.html#ratcave.graphics.Window.flip" title="ratcave.graphics.Window.flip"><code class="xref py py-meth docutils literal"><span class="pre">Window.flip()</span></code></a> methods as usual will take care of the rest!</li>
</ul>
</dd>
</dl>
<div class="section" id="create-the-virtual-scene">
<h2>Create the Virtual Scene<a class="headerlink" href="#create-the-virtual-scene" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s say that our virtual scene contains a sphere and a Monkey head:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ratcave</span> <span class="kn">import</span> <span class="n">graphics</span>

<span class="c"># Make Meshes for the virtual scene</span>
<span class="n">obj_reader</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">WavefrontReader</span><span class="p">(</span><span class="n">graphics</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">obj_primitives</span><span class="p">)</span>
<span class="n">monkey</span> <span class="o">=</span> <span class="n">obj_reader</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="s">&#39;Monkey&#39;</span><span class="p">,</span> <span class="n">centered</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sphere</span> <span class="o">=</span> <span class="n">obj_reader</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="s">&#39;Sphere&#39;</span><span class="p">,</span> <span class="n">centered</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># Put inside a Scene</span>
<span class="n">virtual_scene</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">Scene</span><span class="p">([</span><span class="n">monkey</span><span class="p">,</span> <span class="n">sphere</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="create-the-projected-scene">
<h2>Create the Projected Scene<a class="headerlink" href="#create-the-projected-scene" title="Permalink to this headline">¶</a></h2>
<p>The Projected Scene is what is actually sent to the display.  It will contain the projector as a <a class="reference internal" href="ratcave.graphics.html#ratcave.graphics.Camera" title="ratcave.graphics.Camera"><code class="xref py py-class docutils literal"><span class="pre">Camera</span></code></a> object, and the shape of the projected surface (for example, the rodent&#8217;s arena floor and walls) as a <a class="reference internal" href="ratcave.graphics.html#ratcave.graphics.Mesh" title="ratcave.graphics.Mesh"><code class="xref py py-class docutils literal"><span class="pre">Mesh</span></code></a> object with the <code class="xref py py-attr docutils literal"><span class="pre">Mesh.cubemap</span></code> flag set to True.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Import Arena shape as a Mesh</span>
<span class="n">arena_reader</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">WavefrontReader</span><span class="p">(</span><span class="s">&#39;MyArenaFile.obj&#39;</span><span class="p">)</span>
<span class="n">arena</span> <span class="o">=</span> <span class="n">arena_reader</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="s">&#39;Arena&#39;</span><span class="p">)</span>
<span class="n">arena</span><span class="o">.</span><span class="n">cubemap</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c"># Make a camera with the same intrinsic and extrinsic properties of the projector</span>
<span class="n">projector</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">Camera</span><span class="p">(</span><span class="n">fov_y</span><span class="o">=</span><span class="mf">60.</span><span class="p">,</span> <span class="n">x_shift</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c"># Put inside a Scene</span>
<span class="n">active_scene</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="n">meshes</span><span class="o">=</span><span class="p">[</span><span class="n">arena</span><span class="p">],</span> <span class="n">camera</span><span class="o">=</span><span class="n">projector</span><span class="p">)</span>
</pre></div>
</div>
<p>If you have run the arena scanner and/or the projector calibration console scripts, then the data for these is already saved in the resources file, so you can do this step alternatively in the following way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Import Arena shape as a Mesh</span>
<span class="n">arena_reader</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">WavefrontReader</span><span class="p">(</span><span class="n">graphics</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">obj_arena</span><span class="p">)</span>
<span class="n">arena</span> <span class="o">=</span> <span class="n">arena_reader</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="s">&#39;Arena&#39;</span><span class="p">)</span>
<span class="n">arena</span><span class="o">.</span><span class="n">cubemap</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c"># Make a camera with the same intrinsic and extrinsic properties of the projector</span>
<span class="n">projector</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">projector</span>

<span class="c"># Put inside a Scene</span>
<span class="n">active_scene</span> <span class="o">=</span> <span class="n">grahpics</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="n">meshes</span><span class="o">=</span><span class="p">[</span><span class="n">arena</span><span class="p">],</span> <span class="n">camera</span><span class="o">=</span><span class="n">projector</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="put-the-scenes-into-a-window">
<h2>Put the Scenes into a Window<a class="headerlink" href="#put-the-scenes-into-a-window" title="Permalink to this headline">¶</a></h2>
<p>The Window will correctly handle the data so long as it knows which scene should be processed in which way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create Window</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">active_scene</span><span class="o">=</span><span class="n">active_scene</span><span class="p">,</span> <span class="n">virtual_scene</span><span class="o">=</span><span class="n">virtual_scene</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tracking-the-subject-player">
<h2>Tracking The Subject / Player<a class="headerlink" href="#tracking-the-subject-player" title="Permalink to this headline">¶</a></h2>
<p>Finally, you need to tell ratCAVE from which perspective the virtual scene should be drawn from! This perpsective is the virtual scene&#8217;s camera.  In this tutorial, we&#8217;ll use our <a class="reference internal" href="ratcave.devices.html#ratcave.devices.Optitrack" title="ratcave.devices.Optitrack"><code class="xref py py-class docutils literal"><span class="pre">Optitrack</span></code></a> object to get the player&#8217;s position, but any method you wish can be used to assign an x,y,z position to the virtual scene&#8217;s <code class="xref py py-attr docutils literal"><span class="pre">Scene.camera.position</span></code> attribute:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ratcave.devices</span> <span class="kn">import</span> <span class="n">Optitrack</span>

<span class="c"># Connect to the motion tracker and get the player&#39;s position as an object</span>
<span class="n">tracker</span> <span class="o">=</span> <span class="n">Optitrack</span><span class="p">()</span>
<span class="n">player_tracked</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">rigid_bodies</span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">]</span>

<span class="c"># Assign a variable to the virtual scene camera, for convenience</span>
<span class="n">player_camera</span> <span class="o">=</span> <span class="n">virtual_scene</span><span class="o">.</span><span class="n">camera</span>

<span class="c"># Put the camera position in the same location as the camera position</span>
<span class="n">player_camera</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">player_tracked</span><span class="o">.</span><span class="n">position</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The rotation angle of the virtual camera doesn&#8217;t matter, as the cubemapping approach renders the scene 360-degrees around the player.</p>
</div>
</div>
<div class="section" id="display-loop">
<h2>Display Loop<a class="headerlink" href="#display-loop" title="Permalink to this headline">¶</a></h2>
<p>Now, we simply display!  We&#8217;ll add another check to for if the user presses the escape key to exit, for convenience:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">psychopy.events</span> <span class="kn">import</span> <span class="n">getKeys</span>

<span class="k">while</span> <span class="s">&#39;escape&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">getKeys</span><span class="p">():</span>

    <span class="c"># Update the virtual camera&#39;s position to the player&#39;s perspective in real-time</span>
    <span class="n">player_camera</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">player_tracked</span><span class="o">.</span><span class="n">position</span>

    <span class="c"># Render the Scenes and push to the display</span>
    <span class="n">window</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="n">window</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-your-virtual-meshes-in-arena-coordinates">
<h2>Setting your virtual meshes in Arena-Coordinates<a class="headerlink" href="#setting-your-virtual-meshes-in-arena-coordinates" title="Permalink to this headline">¶</a></h2>
<p>While the above steps are enough for getting a picture, it defines all positions in your tracker&#8217;s space.  But what if the arena itself shifts, or rotates?  Then all of your careful alignment would be lost&#8211;virtual objects placed inside the arena could be positioned outside the arena!</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This problem does not affect the Mesh&#8217;s apparant shape, however&#8211;all geometric warping will continue to be correct.</p>
</div>
<p>To solve this, we can set each virtual Mesh&#8217;s <code class="xref py py-attr docutils literal"><span class="pre">Mesh.global.position</span></code> and <code class="xref py py-attr docutils literal"><span class="pre">Mesh.global.rotation</span></code> properties to match the position of the Arena!  When this happens, everything will be centered on the arena, and their <code class="xref py py-attr docutils literal"><span class="pre">Mesh.local.position</span></code> and <code class="xref py py-attr docutils literal"><span class="pre">Mesh.local.rotatoin</span></code> properties can be used to reposition them as normal.  Doing this thus moves your positioning from <em>Absolute Coordinates</em> to <em>Relative Coordinates</em>.  No more problems!</p>
<p>Here&#8217;s how you can do that in real-time, allowing even a constantly-moving arena to stay updated:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Set virtual meshes to relative coordinate system.</span>
<span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="n">active_scene</span><span class="o">.</span><span class="n">meshes</span><span class="p">:</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">arena</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">position</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">arena</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">rotation</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-rotation-invariant-tracking-coordinates">
<h2>Getting Rotation-Invariant Tracking Coordinates<a class="headerlink" href="#getting-rotation-invariant-tracking-coordinates" title="Permalink to this headline">¶</a></h2>
<p>When a new object is being tracked, the position of the object is fairly easy to ascertain, but its rotation is not; as a result, many trackers will define any new object as starting with zero rotation, and simply tracking from there.  But what if you want to track an object that you need to redefine?  Rescanning the object helps this problem, as does saving the original tracking data for future use, but if something is lost or changed then everything&#8211;arena body defining, arena scanning, and experiment positioning&#8211; would need to be redone.</p>
<p>To help with this problem, ratCAVE tracker objects have a <code class="xref py py-attr docutils literal"><span class="pre">Tracker.rotation_pca_y</span></code> attribute that defines an object&#8217;s rotation in terms of the addition of the tracker server&#8217;s stated rotation and the angle between its default vector and the vector of maximum variance, along the direction of its highest variance.  This way, the rotation is totally defined by the marker configuration itself (how we tend to think of the object&#8217;s rotation) instead of its rotation when first defined.</p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Need to better explain the <code class="xref py py-attr docutils literal"><span class="pre">Tracker.rotation_pca_y</span></code> concept in the future.</p>
</div>
<p>Further, the arena_scanner.py console script can automatically rotate the arena vertices so that these two rotations match.  So, when using files generated by this scanner, the rotation_pca_y information must be used instead of the rotation data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">arena_tracked</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">rigid_bodies</span><span class="p">[</span><span class="s">&#39;Arena&#39;</span><span class="p">]</span>
<span class="n">arena</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">arena_tracked</span><span class="o">.</span><span class="n">position</span>
<span class="n">arena</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">arena_tracked</span><span class="o">.</span><span class="n">rotation_pca_y</span>
</pre></div>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Here&#8217;s the final code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Imports</span>
<span class="kn">from</span> <span class="nn">ratcave</span> <span class="kn">import</span> <span class="n">graphics</span>
<span class="kn">from</span> <span class="nn">ratcave.devices</span> <span class="kn">import</span> <span class="n">Optitrack</span>
<span class="kn">from</span> <span class="nn">psychopy.events</span> <span class="kn">import</span> <span class="n">getKeys</span>

<span class="c"># Make Meshes for the virtual scene</span>
<span class="n">obj_reader</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">WavefrontReader</span><span class="p">(</span><span class="n">graphics</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">obj_primitives</span><span class="p">)</span>
<span class="n">monkey</span> <span class="o">=</span> <span class="n">obj_reader</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="s">&#39;Monkey&#39;</span><span class="p">,</span> <span class="n">centered</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sphere</span> <span class="o">=</span> <span class="n">obj_reader</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="s">&#39;Sphere&#39;</span><span class="p">,</span> <span class="n">centered</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">virtual_scene</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">Scene</span><span class="p">([</span><span class="n">monkey</span><span class="p">,</span> <span class="n">sphere</span><span class="p">])</span>

<span class="c"># Import Arena shape as a Mesh</span>
<span class="n">arena_reader</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">WavefrontReader</span><span class="p">(</span><span class="n">graphics</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">obj_arena</span><span class="p">)</span>
<span class="n">arena</span> <span class="o">=</span> <span class="n">arena_reader</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="s">&#39;Arena&#39;</span><span class="p">)</span>
<span class="n">arena</span><span class="o">.</span><span class="n">cubemap</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c"># Make a camera with the same intrinsic and extrinsic properties of the projector</span>
<span class="n">projector</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">projector</span>

<span class="c"># Put inside a Scene</span>
<span class="n">active_scene</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="n">meshes</span><span class="o">=</span><span class="p">[</span><span class="n">arena</span><span class="p">],</span> <span class="n">camera</span><span class="o">=</span><span class="n">projector</span><span class="p">)</span>

<span class="c"># Connect to the motion tracker and get the player&#39;s position as an object</span>
<span class="n">tracker</span> <span class="o">=</span> <span class="n">Optitrack</span><span class="p">()</span>
<span class="n">player_tracked</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">rigid_bodies</span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">]</span>
<span class="n">player_camera</span> <span class="o">=</span> <span class="n">virtual_scene</span><span class="o">.</span><span class="n">camera</span>

<span class="n">arena_tracked</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">rigid_bodies</span><span class="p">[</span><span class="s">&#39;Arena&#39;</span><span class="p">]</span>

<span class="c"># Main Draw Loop</span>
<span class="k">while</span> <span class="s">&#39;escape&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">getKeys</span><span class="p">():</span>

    <span class="c"># Update the virtual camera&#39;s position to the player&#39;s perspective in real-time</span>
    <span class="n">player_camera</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">player_tracked</span><span class="o">.</span><span class="n">position</span>

    <span class="c"># Position virtual meshes relative to the arena.</span>
    <span class="n">arena</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">arena_tracked</span><span class="o">.</span><span class="n">position</span>
    <span class="n">arena</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">arena_tracked</span><span class="o">.</span><span class="n">rotation_pca_y</span>

    <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="n">active_scene</span><span class="o">.</span><span class="n">meshes</span><span class="p">:</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">arena</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">position</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">arena</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">rotation</span>

    <span class="c"># Render the Scenes and push to the display</span>
    <span class="n">window</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>That&#8217;s it!  We&#8217;re still not at a release verision, and we&#8217;ll be adding more features in the future to make this process even easier, so that your coding efforts can be focused on what matters&#8211;your experiments!</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ratcave.html" class="btn btn-neutral float-right" title="API Documentation" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial2.html" class="btn btn-neutral" title="Tutorial 2: Animating a Scene with Multiple Meshes, and using Multiple Scenes" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Nicholas A. Del Grosso.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.5.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>